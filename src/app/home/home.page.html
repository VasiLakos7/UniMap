<ion-header>
  <ion-toolbar color="primary" class="unimap-toolbar">
    <ion-title>{{ 'APP.TITLE' | translate }}</ion-title>

    <ion-buttons slot="end">
      <ion-button
        class="amea-pill"
        (click)="toggleAmea()"
        [color]="ameaEnabled ? 'success' : 'light'"
        [fill]="ameaEnabled ? 'solid' : 'outline'"
        [attr.aria-label]="'A11Y.AMEA_MODE' | translate"
        [attr.aria-pressed]="ameaEnabled"
      >
        <ion-icon name="accessibility-outline" slot="start"></ion-icon>
        <ion-label class="amea-label">{{ 'A11Y.AMEA_MODE' | translate }}</ion-label>
      </ion-button>

      <ion-button
        class="settings-btn"
        (click)="openSettings()"
        [attr.aria-label]="'SETTINGS.TITLE' | translate"
      >
        <ion-icon name="settings-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- MAP -->
  <div id="map"></div>

  <!-- TOP: Search / Nav -->
  <div slot="fixed" class="search-host">
    <ng-container *ngIf="!navEnabled; else navBox">
      <app-search-bar
        [locked]="selectionLocked"
        [placeholderText]="selectionLocked
          ? ('HOME.SEARCH_LOCKED' | translate)
          : ('HOME.SEARCH_PLACEHOLDER' | translate)"
        (destinationSelected)="onDestinationSelected($event)"
        (searchOpenChange)="onSearchOpenChange($event)"
        (lockedAttempt)="onSearchLockedAttempt()">
      </app-search-bar>
    </ng-container>

    <ng-template #navBox>
      <div class="nav-box" [ngClass]="navTheme">
        <div class="nav-top">{{ 'NAV.TITLE' | translate }}</div>
        <div class="nav-body">
          <div class="nav-icon">
            <ion-icon [name]="navIcon"></ion-icon>
          </div>
          <div class="nav-text">
            {{ navInstructionKey | translate: navInstructionParams }}
          </div>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- FIT ROUTE + RECENTER -->
  <div
    slot="fixed"
    class="map-fabs"
    [style.bottom]="'calc(' + recenterBottom + 'px + var(--ion-safe-area-bottom, 0px))'"
    [style.right.px]="12"
  >
    <ion-button
      class="fab-btn"
      shape="round"
      fill="solid"
      (click)="onFitRoute()"
      [disabled]="!canFitRoute || showLockOverlay"
      aria-label="Δείξε όλη τη διαδρομή"
    >
      <ion-icon name="git-network-outline"></ion-icon>
    </ion-button>

    <ion-button
      class="fab-btn"
      shape="round"
      fill="solid"
      (click)="onRecenter()"
      [disabled]="!hasUserFix || showLockOverlay"
      aria-label="Επανεστίαση"
    >
      <ion-icon name="paper-plane-outline"></ion-icon>
    </ion-button>
  </div>

  <!-- POPUP -->
  <div
    *ngIf="showModal && currentDestination"
    slot="fixed"
    class="popup-overlay"
  >
    <app-department-popup
      #popupCard
      [destination]="currentDestination"
      [routeReady]="routeReady"
      [navigationActive]="navigationActive"
      [hasArrived]="hasArrived"
      [meters]="popupMeters"
      [etaMin]="popupEtaMin"
      [units]="settings.units"
      (navigate)="startNavigation()"
      (cancel)="cancelRouteKeepPopup()"
      (close)="onPopupClose()">
    </app-department-popup>
  </div>

  <!-- LOCK OVERLAY -->
  <div *ngIf="showLockOverlay" class="lock-screen">
    <div class="lock-card">{{ 'HOME.OUT_OF_RANGE' | translate }}</div>
  </div>
</ion-content>
